# Configuración de test usando BD de desarrollo
# Basado en application-dev.properties para usar datos reales

spring.application.name=violetaserver-test

# === CONFIGURACIÓN DE BASE DE DATOS ===
# Usar la misma base de datos de desarrollo para tests
spring.datasource.url=jdbc:mariadb://${SERVICIOVIOLETASERVERDB:localhost:3308/20251102_multiempresa}?useSSL=false
spring.datasource.username=root
spring.datasource.password=myroot84
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# Configuración de conexión
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000

# === CONFIGURACIÓN JPA ===
# NO crear/modificar esquema en tests (usar BD existente)
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MariaDBDialect

# Naming strategy - usar nombres exactos de las columnas especificadas en @Column
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl

# === CONFIGURACIÓN DE LOGGING ===
# Más detallado para debugging de tests
logging.level.org.springframework.web=DEBUG
logging.level.com.lavioleta=DEBUG
logging.level.org.springframework.jdbc=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# === CONFIGURACIÓN DE SEGURIDAD ===
# Configuración permisiva para tests
jwt.secret=test-secret-key-for-development-only-not-for-production-use
jwt.expiration=3600000

# Configuración de CORS permisiva para tests
cors.allowed.origins=http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000
cors.allowed.methods=GET,POST,PUT,DELETE,OPTIONS,HEAD
cors.allowed.headers=*
cors.allow.credentials=true

# === CONFIGURACIÓN DE SERVIDOR ===
server.port=8080
server.servlet.context-path=/

# === CONFIGURACIÓN DE ACTUATOR ===
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=always

# === CONFIGURACIÓN DE JACKSON ===
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.serialization.fail-on-empty-beans=false
spring.jackson.deserialization.fail-on-unknown-properties=false

# === CONFIGURACIÓN DE TRANSACCIONES ===
# Para tests, usar transacciones más permisivas
spring.transaction.default-timeout=30
spring.transaction.rollback-on-commit-failure=true

# === DATOS DE PRUEBA ===
# Cliente de prueba existente en BD
test.cliente.codigo=S100579
test.empresa.id=1
test.sucursal.codigo=S1

# === CONFIGURACIÓN DE CACHE ===
spring.cache.type=simple

# === CONFIGURACIÓN DE PERFILES ===
# Nota: spring.profiles.active no se puede definir en archivos profile-específicos
# El perfil 'test' se activa automáticamente por @ActiveProfiles("test")
